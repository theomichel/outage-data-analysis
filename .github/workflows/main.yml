name: Scrape latest outage data

on:
  push:
  workflow_dispatch:
  schedule:
    - cron:  '*/5 * * * *'

env:
  PWRONDATABOT_TOKEN: ${{ secrets.PWRONDATABOT_TOKEN }}
  GEOCODE_API_KEY: ${{ secrets.GEOCODE_API_KEY }}

jobs:
  scheduled:
    runs-on: ubuntu-latest
    defaults:
      run:
        shell: bash
        working-directory: outage-data-analysis
       
    steps:
      - name: Checkout current repository
        uses: actions/checkout@v4
        with:
          path: outage-data-analysis

      - name: Checkout the pse repository
        uses: actions/checkout@v4
        with:
          repository: davemattson/pse-outage
          path: pse-outage
          
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x' # Use the latest Python 3 version
          
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install pykml
          pip install pandas
          pip install pytz
          pip install requests
          pip install gitpython

      - name: Print Working Directory
        run: pwd

      - uses: qoomon/actions--setup-git@v1
        with:
          user: bot

      - name: Run pse notifier
        run: |
          echo "Running PSE notifier"
          cd ../pse-outage
          git status
          git pull
          ls
          git log
          git diff-tree edee40e8dac8fed07502d9e9047c2c7de1f34bd8 46f0cd7d9288c6b623953411cc58f0986e459f31 -r --abbrev=40 --full-index -M --raw -z --no-color
